<!DOCTYPE html>
<html>
  <head>
    <title>Chat Box</title>
    <link rel="stylesheet" href="static/style.css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      // Send the user's question to the server and display the response
      function sendQuestion() {
        var question = $("#question-input").val();
        if (question) {
          var timestamp = new Date().toLocaleTimeString();
          $("#chat-area").append("<div class='message user-message'><span class='timestamp'>" + timestamp + "</span>" + question + "</div>");
          $("#question-input").val("");
          $("#chat-area").scrollTop($("#chat-area").prop("scrollHeight"));
          $("#loading-indicator").show();
          $.ajax({
            url: "/api/chat",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({ question: question }),
            success: function(data) {
              var response = data.response;
              var typingSpeed = 50; // in milliseconds
              var responseArray = response.split(" ");
              var currentIndex = 0;
              var responseTimer = setInterval(function() {
                if (currentIndex < responseArray.length) {
                  var responseText = responseArray.slice(0, currentIndex + 1).join(" ");
                  $("#typing-indicator").html(responseText);
                  currentIndex++;
                } else {
                  clearInterval(responseTimer);
                  var timestamp = new Date().toLocaleTimeString();
                  $("#typing-indicator").html("");
                  $("#chat-area").append("<div class='message bot-message'><span class='timestamp'>" + timestamp + "</span>" + response + "</div>");
                  $("#chat-area").scrollTop($("#chat-area").prop("scrollHeight"));
                  $("#loading-indicator").hide();
                }
              }, typingSpeed);
            },
            error: function() {
              alert("Unable to process the request.");
              $("#loading-indicator").hide();
            }
          });
        }
      }

      // Send the user's question when they press Enter in the text input field
      $("#question-input").keydown(function(event) {
        if (event.keyCode == 13) {
          sendQuestion();
          return false;
        }
      });
    </script>
  </head>
  <body>
    <div id="chat-box">
      <div id="chat-area"></div>
      <div id="input-area">
        <input type="text" id="question-input" placeholder="Type your question here" />
        <button id="send-button" onclick="sendQuestion()">Send</button>
      </div>
      <div id="typing-indicator"></div>
      <div id="loading-indicator">
        <div class="loader"></div>
      </div>
    </div>
  </body>
</html>
